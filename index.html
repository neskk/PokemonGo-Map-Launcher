<!DOCTYPE html>
<html lang="en">
<head>
  <title>PokemonGo-Map Launcher Generator</title>
  <meta charset="utf-8">
  <!-- Metadata -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="PokemonGo-Map Launcher Generator">
  <meta name="keywords" content="PokÃ©mon Go, pogo, pokemon map, pokemon map launcher">
  <meta name="author" content="neskk">
  <link type="text/css" rel="stylesheet" href="styles.css">
  <!-- CSS and External JavaScript -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!--
  <script src="jquery.csv.min.js"></script>
  
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid.min.css" />
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid-theme.min.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid.min.js"></script>
  -->
</head>
<body>
<h2>PokemonGo-Map Launcher Generator</h2>
<p>&nbsp;</p>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h4>Description</h4>
      <p>This generator will output several Unix bash script files (.sh) that are able to launch instances of PokemonGo-Map. If you're using PokeAlert as a webhook server then a script will also be created to launch those instances.</p>
    </div>
  </div>
  <form id="form-config" class="form-horizontal" action="actions.php" method="post" enctype="multipart/form-data">
  <div class="row">
    <div class="col-xs-12 col-md-6">
      <h4>Paths</h4>
      <div class="form-group">
        <label for="path-base" class="col-sm-4 control-label">Base Path</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="path-base" name="path-base" placeholder="~" value="~">
        </div>
      </div>
      <div class="form-group">
        <label for="path-pogomap" class="col-sm-4 control-label">PokemonGo-Map Path</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="path-pogomap" name="path-pogomap" placeholder="PokemonGo-Map" value="PokemonGo-Map">
        </div>
      </div>
      <div class="form-group">
        <label for="path-pokealarm" class="col-sm-4 control-label">PokeAlert Path</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="path-pokealarm" name="path-pokealarm" placeholder="PokeAlarm" value="PokeAlarm">
        </div>
      </div>
      <div class="form-group">
        <label for="path-spclustering" class="col-sm-4 control-label">Spawnpoint Clustering Tool</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="path-spclustering" name="path-spclustering" placeholder="PokemonGo-Map/Tools/Spawnpoint-Clustering" value="PokemonGo-Map/Tools/Spawnpoint-Clustering">
        </div>
      </div>
      <div class="form-group">
        <label for="path-spawnpoints" class="col-sm-4 control-label">Spawnpoint Dumps</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="path-spawnpoints" name="path-spawnpoints" placeholder="spawnpoints" value="spawnpoints">
        </div>
      </div>
      <div class="form-group">
        <label for="path-accounts" class="col-sm-4 control-label">Account Dumps</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="path-accounts" name="path-accounts" placeholder="accounts" value="accounts">
        </div>
      </div>
      <h4>Screen Session Names</h4>
      <div class="form-group">
        <label for="screen-servers" class="col-sm-4 control-label">Servers</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="screen-servers" name="screen-servers" placeholder="servers" value="servers">
        </div>
      </div>
      <div class="form-group">
        <label for="screen-scanners" class="col-sm-4 control-label">Scanners</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="screen-scanners" name="screen-scanners" placeholder="scanners" value="scanners">
        </div>
      </div>
      <div class="form-group">
        <label for="screen-alarms" class="col-sm-4 control-label">Alarms</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="screen-alarms" name="screen-alarms" placeholder="alarms" value="alarms">
        </div>
      </div>
      <div class="form-group">
        <label for="screen-dump-sp" class="col-sm-4 control-label">Dump Spawnpoints</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="screen-dump-sp" name="screen-dump-sp" placeholder="dump-sp" value="dump-sp">
        </div>
      </div>
      <h4>MySQL Config</h4>
      <div class="form-group">
        <label for="mysql-host" class="col-sm-4 control-label">Hostname</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="mysql-host" name="mysql-host" placeholder="localhost" value="localhost">
        </div>
      </div>
      <div class="form-group">
        <label for="mysql-database" class="col-sm-4 control-label">Database</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="mysql-database" name="mysql-database" placeholder="pogomap" value="pogomap">
        </div>
      </div>
      <div class="form-group">
        <label for="mysql-username" class="col-sm-4 control-label">Username</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="mysql-username" name="mysql-username" placeholder="pogomap" value="pogomap">
        </div>
      </div>
      <div class="form-group">
        <label for="mysql-password" class="col-sm-4 control-label">Password</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="mysql-password" name="mysql-password" placeholder="p455w0rd" value="p455w0rd">
        </div>
      </div>
      
    </div>
    <div class="col-xs-12 col-md-6">
      <h4>CSV File Imports</h4>
      <div class="form-group">
        <label for="file-accounts" class="col-sm-4 control-label">Accounts</label>
        <div class="col-sm-8">
          <input type="hidden" name="MAX_FILE_SIZE" value="100000" />
          <input type="file" class="form-control" id="file-accounts" name="file-accounts" accept=".csv">
          <p class="help-block">CSV syntax: service,username,password,banned</p>
        </div>
      </div>
      <div class="form-group">
        <label for="file-alarms" class="col-sm-4 control-label">Alarms</label>
        <div class="col-sm-8">
          <input type="hidden" name="MAX_FILE_SIZE" value="100000" />
          <input type="file" class="form-control" id="file-alarms" name="file-alarms" accept=".csv">
          <p class="help-block">CSV syntax: enabled,address,port,location,name</p>
        </div>
      </div>
      <div class="form-group">
        <label for="file-instances" class="col-sm-4 control-label">Instaces</label>
        <div class="col-sm-8">
          <input type="hidden" name="MAX_FILE_SIZE" value="100000" />
          <input type="file" class="form-control" id="file-instances" name="file-instances" accept=".csv">
          <p class="help-block">CSV syntax: enabled,modes,location,name,st,sd,num_workers,num_accs,webhook</p>
        </div>
      </div>
      <div class="form-group">
        <label for="file-proxies" class="col-sm-4 control-label">SOCKS5 Proxies</label>
        <div class="col-sm-8">
          <input type="hidden" name="MAX_FILE_SIZE" value="100000" />
          <input type="file" class="form-control" id="file-proxies" name="file-proxies" accept=".csv, .txt">
          <p class="help-block">One proxy per line - ip:port</p>
        </div>
      </div>
      <h4>Output Filenames</h4>
      <div class="form-group">
        <label for="output-servers" class="col-sm-4 control-label">Servers</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="output-servers" name="output-servers" placeholder="launch-servers.sh" value="launch-servers.sh">
        </div>
      </div>
      <div class="form-group">
        <label for="output-scanners" class="col-sm-4 control-label">Scanners</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="output-scanners" name="output-scanners" placeholder="launch-scanners.sh" value="launch-scanners.sh">
        </div>
      </div>
      <div class="form-group">
        <label for="output-alarms" class="col-sm-4 control-label">Alarms</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="output-alarms" name="output-alarms" placeholder="launch-alarms.sh" value="launch-alarms.sh">
        </div>
      </div>
      <div class="form-group">
        <label for="output-dump-sp" class="col-sm-4 control-label">Dump Spawnpoints</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="output-dump-sp" name="output-dump-sp" placeholder="dump-spawnpoints.sh" value="dump-spawnpoints.sh">
        </div>
      </div>
      <div class="form-group">
        <label for="output-pogo-captcha" class="col-sm-4 control-label">PoGo-Captcha</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="output-pogo-captcha" name="output-pogo-captcha" placeholder="pogo-captcha.txt" value="pogo-captcha.txt">
        </div>
      </div>
      
      <h4>Configuration</h4>
        <div class="form-group">
          <label for="max-instances" class="col-sm-4 control-label">Instance Limit</label>
          <div class="col-sm-8">
            <input type="text" class="form-control" id="max-instances" name="max-instances" placeholder="0" value="0">
          </div>
        </div>
        <div class="form-group">
          <label for="time-delay-worker" class="col-sm-4 control-label">Time delay per worker</label>
          <div class="col-sm-8">
            <input type="text" class="form-control" id="time-delay-worker" name="time-delay-worker" placeholder="4" value="4">
          </div>
        </div>
        <div class="form-group">
          <label for="account-search-interval" class="col-sm-4 control-label">Account Search Interval</label>
          <div class="col-sm-8">
            <input type="text" class="form-control" id="account-search-interval" name="account-search-interval" placeholder="28800" value="28800">
          </div>
        </div>
        <div class="form-group">
          <label for="account-rest-interval" class="col-sm-4 control-label">Account Rest Interval</label>
          <div class="col-sm-8">
            <input type="text" class="form-control" id="account-rest-interval" name="account-rest-interval" placeholder="7200" value="7200">
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-8">
            <div class="checkbox">
              <label>
                <input type="checkbox" id="shuffle-accounts" name="shuffle-accounts"> Shuffle account list before assigning them
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-8">
            <div class="checkbox">
              <label>
                <input type="checkbox" id="sp-clustering" name="sp-clustering" checked> Use Spawnpoint Clustering
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-8">
            <div class="checkbox">
              <label>
                <input type="checkbox" id="accounts-to-file" name="accounts-to-file" checked> Output accounts to a CSV file for each instance
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-8">
            <div class="checkbox">
              <label>
                <input type="checkbox" id="enable-proxies" name="enable-proxies" checked> Assign proxies to instances
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-8">
            <div class="checkbox">
              <label>
                <input type="checkbox" id="shuffle-proxies" name="shuffle-proxies" checked> Shuffle proxy list before assigning them
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-8">
            <div class="checkbox">
              <label>
                <input type="checkbox" id="log-messages" name="log-messages"> Output debug information to log file
              </label>
            </div>
          </div>
          <label for="log-filename" class="col-sm-4 control-label">Debug log filename</label>
          <div class="col-sm-8">
            <input type="text" class="form-control" id="log-filename" name="log-filename" placeholder="0" value="pokemongo-map.log">
          </div>
        </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 text-center">
      <button type="submit" id="generate-launcher" class="btn btn-primary btn-md"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Generate Launcher</button>
      <button type="button" id="download-launcher" class="btn btn-primary btn-md"><span class="glyphicon glyphicon-download" aria-hidden="true"></span> Download Launcher</button>
      <br />
      <div id="result-message" class="text-justify"></div>
    </div>
  </div>
  </form>
</div>

<script>
$(function() {
  $('#download-launcher').hide();
  
  $('#download-launcher').click(function(e) { 
    window.open($(this).attr("href"));
    $(this).hide();
  });
  
});

$("#form-config").submit(function(e) {
  
  $('#download-launcher').hide();
  $('#result-message').empty();
	
	var formData = new FormData($(this)[0]);

	//prevent Default functionality
	e.preventDefault();
	
	//get the action-url of the form
	var url = e.currentTarget.action;

	//do your own request an handle the results
	$.ajax({
			url: url,
			type: 'post',
			dataType: 'json',
			data: formData,
			success: function(data) {
        var message = data['message'].replace(/(?:\r\n|\r|\n)/g, '<br />');
        var file_id = data['file'];
        
        if(file_id != '') {
          //$('#generate-launcher').hide();
          var fileUrl = "download.php?id="+file_id;
          
          $('#download-launcher').attr("href", fileUrl);
          $('#download-launcher').show();
          
        } else {
				  $('#result-message').html(message);
        }
			},
			cache: false,
			contentType: false,
			processData: false
	});

});
</script>

<script>
  // http://stackoverflow.com/questions/34494032/loading-a-csv-file-into-an-html-table-using-javascript
  // http://www.uselesscode.org/javascript/csv/demo/example-importing-exporting-csv.htm
  
  // https://mindmup.github.io/editable-table/
  /*
  $(document).ready(function() {
    
    // Bind to <input files>
    if(isAPIAvailable()) {
      $('#files').bind('change', handleFileSelect);
    }
  });
  
  // TODO: provide error message
  function isAPIAvailable() {
    // Check for the various File API support.
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      // Great success! All the File APIs are supported.
      return true;
    } else {
      // source: File API availability - http://caniuse.com/#feat=fileapi
      // source: <output> availability - http://html5doctor.com/the-output-element/
      document.writeln('The HTML5 APIs used in this form are only available in the following browsers:<br />');
      // 6.0 File API & 13.0 <output>
      document.writeln(' - Google Chrome: 13.0 or later<br />');
      // 3.6 File API & 6.0 <output>
      document.writeln(' - Mozilla Firefox: 6.0 or later<br />');
      // 10.0 File API & 10.0 <output>
      document.writeln(' - Internet Explorer: Not supported (partial support expected in 10.0)<br />');
      // ? File API & 5.1 <output>
      document.writeln(' - Safari: Not supported<br />');
      // ? File API & 9.2 <output>
      document.writeln(' - Opera: Not supported');
      return false;
    }
  }
  
  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var file = files[0];
    // read the file metadata
    var output = ''
        output += '<span style="font-weight:bold;">' + escape(file.name) + '</span><br />\n';
        output += ' - FileType: ' + (file.type || 'n/a') + '<br />\n';
        output += ' - FileSize: ' + file.size + ' bytes<br />\n';
        output += ' - LastModified: ' + (file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() : 'n/a') + '<br />\n';
    // read the file contents
    printTable(file);
    // post the results
    $('#list').append(output);
  }
  
  function printTable(file) {
    var reader = new FileReader();
    reader.readAsText(file);
    reader.onload = function(event){
      var csv = event.target.result;
      var data = $.csv.toArrays(csv);
      var html = '';
      for(var row in data) {
        html += '<tr>\r\n';
        for(var item in data[row]) {
          html += '<td>' + data[row][item] + '</td>\r\n';
        }
        html += '</tr>\r\n';
      }
      $('#contents').html(html);
    };
    reader.onerror = function(){ alert('Unable to read ' + file.fileName); };
  }

  // TODO: called when generated
  function exportData() {
    var i, j, arr = [], csv,
    rxIsInt = /^\d+$/,
    rxIsFloat = /^\d*\.\d+$|^\d+\.\d*$/,
    rxQuotedNumber = /^"\d+"$|"\.\d+"$|^"\d+\.\d*"$/,
    rows = $('#grid tr');
  
    // Walk the rows of the table and convert them into an array
    rows.each( function() {
      var row = [];
      tds = $(this).find('td');
      tds.each( function () {
        var itm = $(this).text();
        // Since everything in the table was conveted to text when inserted
        // we have to convert it back to a number here before we pass it to 
        // arrayToCsv so it handles them correctly.
        if(rxIsInt.test(itm)) {
          itm = parseInt(itm, 10);
        } else if (rxIsFloat.test(itm)) {
          itm = parseFloat(itm, 10);
        // convert '*null*' to null
        } else if (itm === '*null*') {
          itm = null;
        // don't escape quote quoted numbers
        // instead interpret them as strings containg numbers
        } else if (rxQuotedNumber.test(itm)) {
          itm = itm.replace(/"/g, '')
        }
        row.push(itm);
      });
      arr.push(row);
    });
    
    // Convert the array to csv
    csv = $.csv.fromArrays(arr);
    
    
    // display the generated csv in the textbox
    //$('#inout').val(csv);
  }
  
  function addRow() {
    var i,
        tdCount = $('#grid tr:last>td').length,
        row = '<tr>';
        for (i = 0; i < tdCount; i += 1) {
          row += '<td>*null*</td>';
        }
        row += '</tr>';
    $('#grid tr:last').after(row);
  }
  
  // TODO: export file (save)
  */
</script>
</body>
</html>